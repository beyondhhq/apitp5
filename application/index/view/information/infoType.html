<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>智慧程后台管理系统</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"> {include file="inccss" /}
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <style>
        table.dataTable thead .sorting:after {
            opacity: none;
            content: none;
        }

        table.dataTable thead .sorting_asc:after {
            content: none;
        }
        /* margin-left: 188px; 
        position: absolute; */
    </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            {include file="header" /}
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            {include file="leftmenu" /}
        </aside>
        <!-- 管理员列表页 -->
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    资讯类型
                    <small></small>
                </h1>
                <ol class="breadcrumb">
                    <li>
                        <a href="#">
                            <i class="fa fa-dashboard"></i> 首页</a>
                    </li>
                    <li class="active">资讯类型</li>
                </ol>
            </section>
            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">资讯列表</h3>
                                
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div style="width:50%;float:left;"><button type="button" class="btn btn-primary" data-toggle="modal"
                                    data-target="#exampleModal" data-whatever="@fat">添加</button></div>
                                
                                <table id="example1" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>序列</th>
                                            <th>类型id</th>
                                            <th>类型名称</th>
                                            <th>添加时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                       <?php if(empty($list)){}else{foreach($list as $k=>$v){?>
                                        <tr>
                                            <td><?php echo $k+1;?></td>
                                            <td><?php echo $v['id'];?></td>
                                            <td><?php echo $v['name'];?></td>
                                            <td><?php echo $v['instime'];?></td>
                                            <td>
                                                <input type="hidden" value="<?php echo $v['names'];?>"></input>
                                                <a href="#" value="<?php echo $v['id'];?>" data-toggle="modal"
                                    data-target="#Modal" data-whatever="@fat" class="xiugai">修改</a>&nbsp;&nbsp;
                                                <a href="#" class="removeBtn" value="<?php echo $v['id'];?>">删除</a>
                                            </td>
                                        </tr>
                                        <?php }}?>
                                    </tbody>
                                    <!-- <tfoot>
                                        <tr>
                                            <th>Rendering engine</th>
                                            <th>Browser</th>
                                            <th>Platform(s)</th>
                                            <th>Engine version</th>
                                            <th>CSS grade</th>
                                        </tr>
                                    </tfoot> -->
                                </table>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="exampleModalLabel">New message</h4>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">一级分类：</label>
                                <select class="form-control" id="select1">
                                    <option value="10000">同级分类</option>
                                    <?php if(empty($first)){

                                    }else{
                                       foreach($first as $k=>$v){ ?>                                       
                                        <option value="<?php echo $v['id']?>"><?php echo $v['names']?></option>                                      
                                    <?php }}?>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">二级分类：</label>
                                <select class="form-control" id="select2">
                                    <option value="10000">同级分类</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">三级分类：</label>
                                <select class="form-control" id="select3">
                                    <option value="10000">同级分类</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="message-text" class="control-label">名称：</label>
                                <input class="form-control" id="names">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="add">添加</button>
                    </div>
                </div>
            </div>
        </div>
        
        
        <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="exampleModalLabel">修改分类名称</h4>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="message-text" class="control-label">名称：</label>
                                <input class="form-control" id="mname"></input>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="modify">修改</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal -->
        {include file="footer" /}
        <div class="control-sidebar-bg"></div>
    </div>
    <!-- ./wrapper -->
    <!-- jQuery 3 -->
    {include file="incjs" /}
    <script>
        $(function () {
            // 当前下拉效果
            $(".treeview").eq(3).addClass('active').siblings().removeClass('active');
            $(".treeview").eq(3).addClass('active').siblings().removeClass('active');
            $(".treeview").eq(3).addClass('menu-open').siblings().removeClass('menu-open');
            $(".treeview").eq(3).children('.treeview-menu').children('li').eq(3).addClass('active').siblings().removeClass(
                'active');
            //Initialize Select2 Elements
            $('.select2').select2()

            $('#example1').DataTable({
                'language': {
                    'emptyTable': '没有数据',
                    'loadingRecords': '加载中...',
                    'processing': '查询中...',
                    'search': '搜索:',
                    'lengthMenu': '每页 _MENU_ 件',
                    'zeroRecords': '没有数据',
                    'paginate': {
                        'first': '第一页',
                        'last': '最后一页',
                        'next': '下一页',
                        'previous': '上一页'
                    },
                    'info': '第 _PAGE_ 页 / 总 _PAGES_ 页',
                    'infoEmpty': '没有数据',
                    'infoFiltered': '(过滤总件数 _MAX_ 条)'
                }
            })
            


            // 弹出框
            $('#exampleModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget) // Button that triggered the modal
                var recipient = button.data('') // Extract info from data-* attributes
                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                var modal = $(this)
                modal.find('.modal-title').text('添加分类')
                modal.find('.modal-body input').val(recipient)
            })
			// 弹出框
            $('.xiugai').on('click', function (event) {
				var id= $(this).attr('value');
				var name=$(this).prev().val();
				
                var button = $(event.relatedTarget) // Button that triggered the modal
                var recipient = button.data('') // Extract info from data-* attributes
                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                var names = $("#mname").val(name);
				
				$("#modify").on('click',function(){
				var newname=$("#mname").val();
				if(newname==''){
					  alert("请填写分类名称！");
					
					}else{
						$.post("/index/information/modify",{
                    id:id,
                    newname:newname

                },function(data){

                       if(data.status==1){
					     alert(data.msg);
                         window.location.href("/index/information/infotype");
						   
						   }else{
							   alert(data.msg);
							   
							   }
             
                      

                })
						
						
				}
                
                
            
              })
            })
			$('.removeBtn').on('click',function(){
				 if(confirm("确定要删除吗？"))
                {
				 var id= $(this).attr('value');
			     $.post('/index/information/del',{
					 
					   id:id
					 
					 },function(data){
					    if(data.status==1){
					     alert(data.msg);
                         window.location.href("/index/information/infotype");
						   
						   }else{
							   alert(data.msg);
							   
							   }
					 
					 
					 });
				}
				
			});
            $("#add").on('click',function(){
                var select1=$('#select1').val();
                var select2=$('#select2').val();
				var select3=$('#select3').val();
                var names=$('#names').val();
				if(names==''){
					  alert("请填写分类名称！");
					
					}else{
						$.post("/index/information/addtype",{
                    select1:select1,
                    select2:select2,
					select3:select3,
                    names:names

                },function(data){

                   
                       alert(data.msg);

                       window.location.href("/index/information/infotype");

                })
						
						
				}
                
                
            
            })
            $("#select1").change(function() {
               var select1 = $("#select1").val();
               $.post("/index/information/getsecond",
                 {
                     id:select1
          
                 },
                 function(data){
                  $("#select2").html(data);
                });
            });
			 $("#select2").change(function() {
				 
               var select2 = $("#select2").val();
               $.post("/index/information/getsecond",
                 {
                     id:select2
          
                 },
                 function(data){
                  $("#select3").html(data);
                });
            });
        })
    </script>
</body>

</html>